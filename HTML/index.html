<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Acceuil</title>
    <meta name="description" content="Orion invest , investir c'est grandir">
    <meta name="keywords" content="Orion fiance app" />
    <link rel="icon" type="image/png" href="assets/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/icon/192x192.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="manifest" href="__manifest.json">
</head>

<body>
    <!-- loader -->
    <div id="loader">
        <img src="assets/img/loading-icon.png" alt="icon" class="loading-icon">
    </div>
    <!-- * loader -->
    <!-- App Header -->
    <div class="appHeader bg-primary text-light">
        <div class="left">
            <a href="#" class="headerButton" data-bs-toggle="modal" data-bs-target="#sidebarPanel">
                <div class="left">
                    <ion-icon name="menu-outline"></ion-icon>
                </div>
            </a>
        </div>
        <div class="pageTitle">
            Orion invest
        </div>
        <div class="right">
            <a href="app-notifications.html" class="headerButton">
                <ion-icon class="icon" name="people-circle-outline"></ion-icon>
                <span class="badge badge-danger">8</span>
            </a>
        </div>
    </div>
    <!-- * App Header -->
    <!-- App Capsule -->
    <div id="appCapsule">
        <!-- Wallet -->
        <div class="section full gradientSection">
            <div class="in">
                <h5 class="title mb-2">Solde disponible</h5>
                <h1 class="total" id="userBalance"></h1>
                <div class="wallet-inline-button mt-5">
                    <a href="#" class="item" data-bs-toggle="modal" data-bs-target="#depositActionSheet">
                        <div class="iconbox bg-success">
                            <ion-icon name="arrow-up-outline"></ion-icon>
                        </div>
                        <strong>Recharge</strong>
                    </a>
                    <a href="#" class="item" data-bs-toggle="modal" data-bs-target="#withdrawActionSheet">
                        <div class="iconbox bg-warning">
                            <ion-icon name="arrow-down-outline"></ion-icon>
                        </div>
                        <strong>Retrait</strong>
                    </a>
                    <a href="#" id="shareLink" class="item" data-bs-toggle="modal">
                        <div class="iconbox">
                            <ion-icon name="share-social-outline"></ion-icon>
                        </div>
                        <strong>Lien</strong>
                    </a>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="row mt-2">
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title" align="center">Bonus invitations</div>
                        <div class="value text-success" align="center" id="userReferralBalance">chargement...</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-box">
                        <div class="title" align="center">Total retraits</div>
                        <div class="value text-danger" align="center" id="totalwithdraw">chargement...</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- * Wallet -->


        <!-- Deposit Action Sheet -->
        <div class="modal fade action-sheet" id="depositActionSheet" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Deposit</h5>
                    </div>
                    <div class="modal-body">
                        <div class="action-sheet-content">
                            <form>
                                <div class="form-group basic">
                                    <div class="input-wrapper">
                                        <label class="label" for="phoneNumber">Votre num√©ro</label>
                                        <div class="exchange-group small">
                                            <div class="input-col">
                                                <input type="text" class="form-control form-control-lg pe-0"
                                                    id="phone" placeholder="votre num√©ro de t√©l√©phone" maxlength="14">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group basic">
                                    <div class="input-wrapper">
                                        <label class="label" for="depositAmount">Montant</label>
                                        <div class="exchange-group small">
                                            <div class="input-col">
                                                <input type="text" class="form-control form-control-lg pe-0"
                                                       id="depositAmount" placeholder="entrer le montant" value="2000">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group basic">
                                    <div class="input-wrapper">
                                        <label class="label" for="depositAmount">ID de transaction</label>
                                        <div class="exchange-group small">
                                            <div class="input-col">
                                                <input type="text" class="form-control form-control-lg pe-0"
                                                       id="transactionId" placeholder="Ins√©rer l'ID de votre transaction">
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="section mt-3">
                                    <div class="section-title">Comment faire ?</div>
                                    <div class="card">
                                        <div class="card-body">
                                            <ul class="nav nav-tabs capsuled" role="tablist">
                                                <li class="nav-item">
                                                    <a class="nav-link active" data-bs-toggle="tab" href="#overview" role="tab">
                                                        Cameroun üá®üá≤ 
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab" href="#card" role="tab">
                                                        Gabon üá¨üá¶
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" data-bs-toggle="tab" href="#settings" role="tab">
                                                        Autres üá®üá¨üáπüá©üá®üá´
                                                    </a>
                                                </li>
                                            </ul>
                                            <div class="tab-content mt-1">
                                                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                                                    <h3>Comment recharger son compte ?</h3><br>

                                                    <p>Pour recharger votre compte, suivez ces √©tapes simples :<br><br>

                                                    1-)Choisissez votre op√©rateur : <br><br> 

                                                         a-)Pour Orange : Composez #150*14*257299*656956931*montant#.<br>
                                                         b-)Pour MTN : Composez *126*14*671373978*montant#.<br><br>
                                                    2-)Effectuez la transaction et r√©cup√©rez l'ID de la transaction.<br><br>

                                                    3-)Rendez-vous sur le formulaire de recharge sur la plateforme, collez l'ID de la transaction et validez.

                                                    Votre recharge sera effective dans un d√©lai maximum de 10 minutes.<br><br>

                                                    <strong>Important : <br>

                                                    Assurez-vous que le num√©ro de d√©p√¥t utilis√© est le m√™me que celui associ√© √† votre compte utilisateur.
                                                    En cas de probl√®me, contactez notre assistance.</strong></p>
                                                </div>
                                                <div class="tab-pane fade" id="card" role="tabpanel">
                                                    <h3>Comment recharger son compte ?</h3><br>
                                                    1-)Effectuez un d√©p√¥t via Airtel Money (AM) vers Orange Money (OM).<br>
                                                    1-a)Le num√©ro Orange Money pour le d√©p√¥t est : 656956931.<br><br>
                                                    2-)R√©cup√©rez l‚ÄôID de la transaction apr√®s avoir valid√© le d√©p√¥t.<br><br>
                                                    3-)Saisissez l‚ÄôID dans le formulaire de recharge sur la plateforme et validez.<br><br>
                                                    4-)Votre recharge sera disponible dans un d√©lai de 10 minutes.

                                                </div>
                                                <div class="tab-pane fade" id="settings" role="tabpanel">
                                                    <h3>Comment recharger son compte ?</h3><br>
                                                        1-) Effectuez une transaction sur l'un des num√©ros suivants :<br>
                                                        1-a) **Orange Money (OM)** : 656956931.<br>
                                                        1-b) **MTN Mobile Money (MoMo)** : 671373978.<br><br>

                                                        2-) R√©cup√©rez l‚ÄôID de la transaction apr√®s avoir valid√© l‚Äôop√©ration.<br><br>

                                                        3-) Saisissez l‚ÄôID dans le formulaire de recharge sur la plateforme et validez.<br><br>

                                                        4-) Votre recharge sera disponible dans un d√©lai de **10 minutes**.<br><br>

                                                        **Note** : En cas de probl√®me, veuillez contacter notre assistance.

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <div class="mt-2">
                                    <button type="button" id="buttondeposit" class="btn btn-primary btn-lg btn-block"
                                            data-bs-dismiss="modal">Deposit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- * Deposit Action Sheet-->

        <!-- Withdraw Action Sheet -->
        <div class="modal fade action-sheet" id="withdrawActionSheet" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Withdraw</h5>
                    </div>
                    <div class="modal-body">
                        <div class="action-sheet-content">

                            <form id="withdrawForm">
                                <div class="form-group basic mb-2">
                                    <div class="input-wrapper">
                                        <label class="label" for="phoneNumber">Votre num√©ro de t√©l√©phone</label>
                                        <input type="text" class="form-control" id="phoneNumber"
                                            placeholder="Entrer votre num√©ro de t√©l√©phone" />
                                        <i class="clear-input">
                                            <ion-icon name="close-circle"></ion-icon>
                                        </i>
                                    </div>
                                </div>
                                <div class="form-group basic mb-2">
                                    <div class="input-wrapper">
                                        <label class="label" for="amount">Montant</label>
                                        <input type="number" class="form-control" id="amount"
                                            placeholder="Entrer le montant" />
                                        <i class="clear-input">
                                            <ion-icon name="close-circle"></ion-icon>
                                        </i>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <button type="button" id="withdrawButton" class="btn btn-primary btn-lg btn-block">
                                        Demande de retrait
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- * Withdraw Action Sheet-->
        <!-- Transactions -->
        <div class="section mt-4" id="transactions-section" style="display: none;">
            <div class="section-heading">
                <h2 class="title">Transactions</h2>
                <a href="crypto-transactions.html" class="link">Voir tout</a>
            </div>
            <div>
                <div class="mt-1"></div>
                <div class="card">
                    <!-- D√©tails des transactions ici -->
                </div>
                <ul class="listview flush transparent no-line image-listview detailed-list mt-1 mb-1" id="transactions-list">
                    <!-- Transactions dynamiques ici -->
                </ul>
            </div>
        </div>
        <!-- Transactions -->
        <!--Component Dialog-->
        <div class="modal fade dialogbox" id="alertModal" data-bs-backdrop="static" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-icon" id="alertModalIcon">
                        <ion-icon name="information-circle"></ion-icon>
                    </div>
                    <div class="modal-header">
                        <h5 class="modal-title" id="alertModalTitle">Info</h5>
                    </div>
                    <div class="modal-body" id="alertModalMessage">Ceci est un message d'information.</div>
                    <div class="modal-footer">
                        <div class="btn-inline">
                            <a href="#" class="btn" data-bs-dismiss="modal">FERMER</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Component Dialog-->

        <!-- Slider -->
        <div class="section mt-4 full">
            <div class="carousel-single splide">
                <div class="splide__track">
                    <ul class="splide__list">
                        <li class="splide__slide">
                            <div class="card card-with-icon">
                                <div class="card-body pt-3 pb-3 text-center">
                                    <div class="card-icon bg-success mb-2">
                                        <ion-icon name="link"></ion-icon>
                                    </div>
                                    <h3 class="card-titlde mb-1">Invitez un ami</h3>
                                    <p>Invitez un ami et gagnez de l'argent</p>
                                    <div class="row">
                                        <div class="col">
                                            <a href="#" class="btn btn-secondary">
                                                <ion-icon name="copy-outline"></ion-icon>
                                                Invitez maintenant
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="splide__slide">
                            <div class="card card-with-icon">
                                <div class="card-body pt-3 pb-3 text-center">
                                    <div class="card-icon mb-2">
                                        <ion-icon name="chatbox-ellipses"></ion-icon>
                                    </div>
                                    <h3 class="card-titlde mb-1">Rejoignez notre groupe de discussion</h3>
                                    <p>Parlons des meilleurs opportunit√©s pour avoir un retour rapide sur investissement</p>
                                    <div class="row">
                                        <div class="col">
                                            <a href="https://t.me/+tm7QvqDRa8Q3N2Fh" class="btn btn-block btn-primary">
                                                Rejoignez-nous
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a href="https://t.me/+tm7QvqDRa8Q3N2Fh" class="btn btn-block btn-secondary">
                                                Voir le groupe
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- * Slider -->
        <!-- app footer -->
        <!-- <div class="appFooter">
            <div class="footer-title">
                Copyright ¬© Orion invest 2024. All Rights Reserved.
            </div>
            Gagnez de l'argent n'a jamais √©t√© aussi facile :)
        </div> -->
        <!-- * app footer -->
    </div>
    <!-- * App Capsule -->
    <!-- App Bottom Menu -->
    <div class="appBottomMenu">
        <a href="index.html" class="item active">
            <div class="col">
                <ion-icon name="home-outline"></ion-icon>
                <strong>Acceuil</strong>
            </div>
        </a>
        <a href="app-bills.html" class="item">
            <div class="col">
                <ion-icon name="cash-sharp"></ion-icon>
                <strong>Forfaits</strong>
            </div>
        </a>
        <a href="crypto-transactions.html" class="item">
            <div class="col">
                <ion-icon name="analytics-outline"></ion-icon>
                <strong>Transactions</strong>
            </div>
        </a>
        <a href="app-faq.html" class="item">
            <div class="col">
                <ion-icon name="help-circle-outline"></ion-icon>
                <strong> A propos de nous</strong>
            </div>
        </a>
        <a href="app-settings.html" class="item">
            <div class="col">
                <ion-icon name="settings-outline"></ion-icon>
                <strong>Settings</strong>
            </div>
        </a>
    </div>
    <!-- * App Bottom Menu -->
    <!-- App Sidebar -->
    <div class="modal fade panelbox panelbox-left" id="sidebarPanel" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <!-- profile box -->
                    <div class="profileBox pt-2 pb-2">
                        <div class="in">
                            <strong id="userName"></strong>
                            <div class="text-muted">
                                <h5 id="userPhone"></h5>
                            </div>
                        </div>
                        <a href="#" class="btn btn-link btn-icon sidebar-close" data-bs-dismiss="modal">
                            <ion-icon name="close-outline"></ion-icon>
                        </a>
                    </div>
                    <!-- * profile box -->
                    <!-- balance -->
                    <div class="sidebar-balance">
                        <div class="listview-title">Solde de compte</div>
                        <div class="in">
                            <h1 class="amount" id="userBalance1"></h1>
                        </div>
                    </div>
                    <!-- * balance -->
                    <!-- action group -->
                    <div class="action-group">
                    </div>
                    <!-- * action group -->
                    <!-- menu -->
                    <div class="listview-title mt-1">Menu</div>
                    <!-- * menu -->
                    <!-- others -->
                    <ul class="listview flush transparent no-line image-listview">
                        <li>
                            <a href="app-settings.html" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="settings-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Param√®tres
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="app-faq.html" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="chatbubble-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Contact
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="app-login.html" class="item">
                                <div class="icon-box bg-primary">
                                    <ion-icon name="log-out-outline"></ion-icon>
                                </div>
                                <div class="in">
                                    Se d√©connecter
                                </div>
                            </a>
                        </li>
                    </ul>
                    <!-- * others -->
                </div>
            </div>
        </div>
    </div>
    <!-- * App Sidebar -->
    <!-- ========= JS Files =========  -->
    <!-- Bootstrap -->
    <script src="assets/js/lib/bootstrap.bundle.min.js"></script>
    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <!-- Splide -->
    <script src="assets/js/plugins/splide/splide.min.js"></script>
    <!-- Apex Charts -->
    <script src="assets/js/plugins/apexcharts/apexcharts.min.js"></script>
    <!-- Base Js File -->
    <script src="assets/js/base.js"></script>
    <script>
        var sparklineAreaExampleSuccess1 = {
            series: [{
                data: [555, 1222, 777, 888, 555, 888, 999, 1222]
            }],
            chart: {
                type: 'area',
                width: '100%',
                height: 70,
                sparkline: {
                    enabled: true
                }
            },
            stroke: {
                width: 2,
            },
            colors: ['#1DCC70'],
            tooltip: {
                enabled: false
            }
        };
        var sparklineAreaExampleSuccess2 = {
            series: [{
                data: [55, 66, 55, 77, 66, 180, 290, 333]
            }],
            chart: {
                type: 'area',
                width: '100%',
                height: 70,
                sparkline: {
                    enabled: true
                }
            },
            stroke: {
                width: 2,
            },
            colors: ['#1DCC70'],
            tooltip: {
                enabled: false
            }
        };
        var sparklineAreaExampleDanger1 = {
            series: [{
                data: [2222, 1666, 1444, 1777, 1333, 1111, 777, 666]
            }],
            chart: {
                type: 'area',
                width: '100%',
                height: 70,
                sparkline: {
                    enabled: true
                }
            },
            stroke: {
                width: 2,
            },
            colors: ['#FF396F'],
            tooltip: {
                enabled: false
            }
        };
        var sparklineAreaExampleDanger2 = {
            series: [{
                data: [1200, 1444, 2900, 505, 531, 1900, 555, 75]
            }],
            chart: {
                type: 'area',
                width: '100%',
                height: 70,
                sparkline: {
                    enabled: true
                }
            },
            stroke: {
                width: 2,
            },
            colors: ['#FF396F'],
            tooltip: {
                enabled: false
            }
        };
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.chart-sparkline-success-1').forEach(chart => new ApexCharts(chart, sparklineAreaExampleSuccess1).render());
            document.querySelectorAll('.chart-sparkline-success-2').forEach(chart => new ApexCharts(chart, sparklineAreaExampleSuccess2).render());
            document.querySelectorAll('.chart-sparkline-danger-1').forEach(chart => new ApexCharts(chart, sparklineAreaExampleDanger1).render());
            document.querySelectorAll('.chart-sparkline-danger-2').forEach(chart => new ApexCharts(chart, sparklineAreaExampleDanger2).render());
        })</script>

<script>
// R√©cup√©rer le token depuis le stockage local
const token = localStorage.getItem('authToken');

// √âv√©nement d√©clench√© lorsque le DOM est charg√©
document.addEventListener('DOMContentLoaded', () => {
    getUserProfile();
    fetchTransactions();
});

/**
 * Fonction pour r√©cup√©rer et afficher le profil utilisateur
 */
async function getUserProfile() {
    try {
        const response = await fetch('https://lionfish-app-54bdv.ondigitalocean.app/user/profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
        });

        // V√©rification de la r√©ponse
        if (!response.ok) {
            if (response.status === 403) {
                handleInvalidSession();
                return;
            }
            throw new Error('Erreur lors de la r√©cup√©ration du profil utilisateur.');
        }

        // R√©cup√©rer les donn√©es utilisateur
        const userData = await response.json();


        const userBalance = document.getElementById('userBalance');
        const userBalance1 = document.getElementById('userBalance1');
        const userReferralBalance = document.getElementById('userReferralBalance');
        const userName = document.getElementById('userName');
        const userPhone = document.getElementById('userPhone');
        const totalwithdraw = document.getElementById('totalwithdraw');

        userBalance.innerHTML = userData.balance  + " FCFA";
        userBalance1.innerHTML = userData.balance  + " FCFA";
        userReferralBalance.innerHTML = userData.referral_balance  + " FCFA";
        userName.innerHTML = userData.name;
        userPhone.innerHTML = userData.phone_number;
        totalwithdraw.innerHTML = userData.TotalWithdraw + " FCFA"




        handleUserProfile(userData);
    } catch (error) {
        console.error('Erreur:', error.message);
    }
}

/**
 * G√®re les donn√©es du profil utilisateur
 * @param {Object} userData - Donn√©es utilisateur r√©cup√©r√©es
 */
 function handleUserProfile(userData) {
    const userReferralCode = userData.referral_code;
    const currentUrl = window.location.origin + "/app-register.html"; // Ajouter la route "/app-register"
    const shareLink = document.getElementById("shareLink");

    // Construire l'URL de parrainage
    const shareUrl = `${currentUrl}?userReferralCode=${userReferralCode}`;
    shareLink.href = shareUrl;

    // Ajouter un gestionnaire pour copier le lien
    shareLink.addEventListener("click", (event) => {
        event.preventDefault();
        copyToClipboard(shareUrl);
    });
}



/**
 * G√®re les sessions invalides ou expir√©es
 */
function handleInvalidSession() {
    localStorage.removeItem('authToken'); // Supprime le token invalide
    showAlert('info','Session expir√© : vous devez vous reconecter');

    // Redirection apr√®s 3 secondes
    setTimeout(() => {
        window.location.href = 'component-fullpage-slider.html'; // Remplacez par l'URL de votre page de connexion
    }, 3000);
}

/**
 * Copie une URL dans le presse-papier
 * @param {string} url - URL √† copier
 */
function copyToClipboard(url) {
    const tempInput = document.createElement("input");
    tempInput.value = url;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand("copy");
    document.body.removeChild(tempInput);
    showAlert('info', 'Votre lien a √©t√© copi√©.');

}

/**
 * Fonction pour r√©cup√©rer les transactions
 */
async function fetchTransactions() {
    try {
        const response = await fetch('https://lionfish-app-54bdv.ondigitalocean.app/transaction/history', {
            headers: { Authorization: `Bearer ${token}` },
        });

        if (!response.ok) {
            if (response.status === 403) {
                handleInvalidSession();
                return;
            }
            throw new Error('Erreur lors de la r√©cup√©ration des transactions.');
        }

        const transactions = await response.json();
        const transactionsSection = document.getElementById('transactions-section');

        if (transactions.length > 0) {
            transactionsSection.style.display = 'block';
            displayTransactions(transactions);
        } else {
            transactionsSection.style.display = 'none';
            console.log('Aucune transaction trouv√©e.');
        }
    } catch (error) {
        console.error('Erreur:', error.message);
    }
}

/**
 * Fonction pour afficher les transactions dans une liste
 * @param {Array} transactions - Liste des transactions
 */
 function displayTransactions(transactions) {
    const transactionsList = document.getElementById('transactions-list');
    transactionsList.innerHTML = ''; // Nettoyer la liste

    // Traductions des types de transaction
    const typeTranslations = {
        deposit: 'D√©p√¥t d\'argent',
        withdrawal: 'Retrait',
        package_purchase: 'Achat de forfait',
    };

    // Traductions des statuts de transaction
    const statusTranslations = {
        completed: 'Termin√©',
        pending: 'En attente',
        failed: '√âchou√©',
    };

    // Gestion des couleurs pour les statuts
    const statusColors = {
        completed: 'text-success',
        pending: 'text-warning',
        failed: 'text-danger',
    };

    // Trier par date (du plus r√©cent au plus ancien)
    transactions.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    // Afficher les 3 premi√®res transactions
    const recentTransactions = transactions.slice(0, 3);

    recentTransactions.forEach((transaction) => {
        const listItem = document.createElement('li');
        let iconClass, iconName;

        // D√©terminer l'ic√¥ne et la classe en fonction du type de transaction
        switch (transaction.type) {
            case 'deposit':
                iconClass = 'bg-success';
                iconName = 'arrow-up-outline';
                break;
            case 'withdrawal':
                iconClass = 'bg-danger';
                iconName = 'arrow-down-outline';
                break;
            case 'package_purchase':
                iconClass = 'bg-secondary';
                iconName = 'swap-vertical-outline';
                break;
            default:
                iconClass = 'bg-primary';
                iconName = 'help-outline';
                break;
        }

        // Traduire et appliquer la couleur du statut
        const statusClass = statusColors[transaction.status] || 'text-secondary';
        const statusLabel = statusTranslations[transaction.status] || 'Inconnu';

        // Traduire le type de transaction
        const typeLabel = typeTranslations[transaction.type] || 'Type inconnu';

        // Ajouter les d√©tails de la transaction √† l'√©l√©ment HTML
        listItem.innerHTML = `
            <a href="#" class="item">
                <div class="icon-box ${iconClass}">
                    <ion-icon name="${iconName}"></ion-icon>
                </div>
                <div class="in">
                    <div>
                        <strong>${typeLabel}</strong>
                        <div class="text-small ${statusClass}">${statusLabel}</div>
                    </div>
                    <div class="text-end">
                        <strong>${transaction.amount || '0'} FCFA</strong>
                        <div class="text-small">
                            ${new Date(transaction.createdAt).toLocaleString("fr-FR", {
                                weekday: "short",
                                day: "numeric",
                                month: "short",
                                year: "numeric",
                                hour: "2-digit",
                                minute: "2-digit",
                            })}
                        </div>
                    </div>
                </div>
            </a>
        `;

        // Ajouter la transaction √† la liste
        transactionsList.appendChild(listItem);
    });
}
    


/**
 * Fonction pour enclencher les retraits
 *  */

 document.getElementById('withdrawButton').addEventListener('click', async () => {
  const operatorNumber = document.getElementById('phoneNumber').value;
  let amount = document.getElementById('amount').value;

  // Conversion de amount en number
  amount = Number(amount);

  if (isNaN(amount) || amount <= 0) {
    showAlert('info', 'Veuillez entrer un montant valide.');
    return;
  }

  if (isNaN(amount) || amount < 2000) {
    showAlert('info', 'le montant minimal est de 2000 FCFA.');
    return;
  }
  try {
    const response = await fetch('https://lionfish-app-54bdv.ondigitalocean.app/transaction/withdraw', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}` // Ajout du token dans les en-t√™tes
      },
      body: JSON.stringify({ amount,operatorNumber }) // Correspondance des champs envoy√©s
    });

    if (response.ok) {
      const data = await response.json();
      showAlert('success', 'Votre demande de retrait r√©eussi avec succ√®s !');

      // Redirection apr√®s 3 secondes
    setTimeout(() => {
        window.location.href = 'index.html'; // Remplacez par l'URL de votre page de connexion
    }, 3000);
    } else {
      const errorData = await response.json();
      console.error('Erreur lors du retrait :', errorData.message);
      showAlert('error', 'Erreur lors du retrait : ' + errorData.message);
    }
  } catch (error) {
    console.error('Erreur r√©seau ou serveur :', error);
    showAlert('error', 'Une erreur est survenue. Veuillez r√©essayer.');

  }
});



/**
 * Fonction pour enclencher les d√©pots
 */
 document.getElementById('buttondeposit').addEventListener('click', async (event) => {
    event.preventDefault(); // Emp√™che le comportement par d√©faut du bouton

    // Obtenir l'heure actuelle du Cameroun (UTC+1)
    const currentTime = new Date();
    const offset = currentTime.getTimezoneOffset(); // D√©calage de fuseau horaire en minutes
    const cameroonTime = new Date(currentTime.getTime() + offset * 60000 + 3600000); // Ajuster pour UTC+1
    const currentHour = cameroonTime.getHours();
    const currentMinutes = cameroonTime.getMinutes();

    // V√©rification de l'heure autoris√©e
    if (currentHour < 9 || (currentHour === 22 && currentMinutes > 30) || currentHour > 22) {
        showAlert('info', 'Les d√©p√¥ts sont autoris√©s uniquement entre 9h00 et 22h30.');
        return; // Arr√™ter l'ex√©cution si l'heure est en dehors de la plage autoris√©e
    }

    // R√©cup√©ration des valeurs des champs
    const phoneNumber = document.getElementById('phone').value.trim();
    let amount = document.getElementById('depositAmount').value.trim();
    const operatorTransactionId = document.getElementById('transactionId').value.trim();
    amount = parseFloat(amount);
    userId = localStorage.getItem('userId');

    // Validation simple
    if (!phoneNumber || !amount || !operatorTransactionId) {
        showAlert('info', 'Tous les champs doivent √™tre remplis');
        return;
    }

    if (amount <= 0) {
        showAlert('info', 'Veuillez ins√©rer un montant valide');

        return; // Stopper l'ex√©cution si le montant est invalide
    }

    if (amount < 2000) {
        showAlert('info', 'Le montant minimal est de 5000 FCFA');
        return; // Stopper l'ex√©cution si le montant est trop faible
    }

    const operatorTransactionIdRegex = /^[A-Z]{2}\d{6}\.\d{4}\.[A-Z0-9]{6}$|^\d{10,11}$/;
    if (!operatorTransactionIdRegex.test(operatorTransactionId)) {
        showAlert('info', 'Format ID invalide');

        return; // Stopper l'ex√©cution si l'ID de transaction est invalide
    }

    try {
        // Envoi des donn√©es √† la route via fetch
        const response = await fetch('https://lionfish-app-54bdv.ondigitalocean.app/transaction/init-deposit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({amount, operatorTransactionId,userId }),
        });

        // Gestion de la r√©ponse
        const result = await response.json();

        if (response.ok) {
            showAlert('Succ√®s','D√©p√¥t r√©ussi : ' + result.message);

            // Redirection apr√®s 3 secondes
            setTimeout(() => {
             window.location.href = 'index.html'; // Remplacez par l'URL de votre page de connexion
                     }, 3000);

        } else {
            showAlert('error','Erreur lors du d√©p√¥t : ' + result.message);

        }
    } catch (error) {
        alert('Erreur de connexion au serveur : ' + error.message);
    }
});


/**
 * Fonction pour Message d'alerte
 */
 function showAlert(type, message) {
    // S√©lectionner les √©l√©ments de la modal
    const modalTitle = document.getElementById('alertModalTitle');
    const modalMessage = document.getElementById('alertModalMessage');
    const modalIcon = document.getElementById('alertModalIcon');

    // Personnaliser la modal en fonction du type
    switch (type) {
        case 'success':
            modalTitle.textContent = 'Succ√®s';
            modalMessage.textContent = message;
            modalIcon.innerHTML = '<ion-icon name="checkmark-circle"></ion-icon>';
            modalIcon.className = 'modal-icon text-success';
            break;

        case 'error':
            modalTitle.textContent = 'Erreur';
            modalMessage.textContent = message;
            modalIcon.innerHTML = '<ion-icon name="alert-circle"></ion-icon>';
            modalIcon.className = 'modal-icon text-danger';
            break;

        case 'info':
        default:
            modalTitle.textContent = 'Info';
            modalMessage.textContent = message;
            modalIcon.innerHTML = '<ion-icon name="information-circle"></ion-icon>';
            modalIcon.className = 'modal-icon text-primary';
            break;
    }

    // Afficher la modal
    const modal = new bootstrap.Modal(document.getElementById('alertModal'));
    modal.show();
}



    </script>
</body>

</html>